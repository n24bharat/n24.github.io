<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Independent India News Monitor</title>

  <meta name="description" content="Independent, data-driven journalism tracking Indian government policy, accountability and public interest reporting." />
  <meta name="keywords" content="India news, independent journalism, Ravish Kumar, Ajit Anjum" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <style>
    :root {
      --bg: #f4f4f4;
      --card: #ffffff;
      --text: #222;
      --muted: #666;
      --accent: #b30000;
      --link: #0b5ed7;
    }

    * { box-sizing: border-box; }

    body {
      margin: 0;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, sans-serif;
      background: var(--bg);
      color: var(--text);
      line-height: 1.6;
    }

    header {
      background: #111;
      color: #fff;
      padding: 1rem;
      text-align: center;
    }

    header h1 { margin: 0; font-size: 1.6rem; }
    header p { margin: 0.3rem 0; font-size: 0.9rem; color: #ccc; }

    .top-bar {
      display: flex;
      justify-content: space-between;
      align-items: center;
      background: #222;
      padding: 0 1rem;
      flex-wrap: wrap;
    }

    nav button, .lang-toggle button {
      background: none;
      border: none;
      color: #ccc;
      padding: 0.8rem 1rem;
      cursor: pointer;
      font-size: 0.9rem;
    }

    nav button.active, .lang-toggle button.active {
      color: #fff;
      border-bottom: 3px solid var(--accent);
    }

    main {
      max-width: 1000px;
      margin: auto;
      padding: 1rem;
    }

    .search input {
      width: 100%;
      padding: 0.7rem;
      font-size: 1rem;
      border-radius: 6px;
      border: 1px solid #ccc;
      margin-bottom: 1rem;
    }

    .period-select {
      margin-bottom: 1rem;
    }
    
    /* Style for the loading message */
    #loading-message {
      text-align: center;
      color: var(--muted);
      padding: 2rem;
      font-style: italic;
    }

    section { display: none; }
    section.active { display: block; }

    article {
      background: var(--card);
      padding: 1rem;
      margin-bottom: 1rem;
      border-left: 4px solid var(--accent);
      border-radius: 4px;
    }

    article h2 {
      margin: 0 0 0.4rem;
      font-size: 1.05rem;
    }

    .meta {
      font-size: 0.85rem;
      color: var(--muted);
      margin-bottom: 0.4rem;
    }

    a { color: var(--link); text-decoration: none; }
    a:hover { text-decoration: underline; }

    footer {
      text-align: center;
      font-size: 0.8rem;
      color: var(--muted);
      padding: 1rem;
    }
  </style>
</head>

<body>

<header>
  <h1 id="title">Independent India News Monitor</h1>
  <p id="subtitle">Policy â€¢ Accountability â€¢ Independent Journalism</p>
</header>

<div class="top-bar">
<nav>
  <button class="active" data-tab="news" onclick="switchTab('news', this)">ðŸ“° <span data-en="News" data-hi="à¤¸à¤®à¤¾à¤šà¤¾à¤°">News</span></button>
  <button data-tab="videos" onclick="switchTab('videos', this)">ðŸŽ¥ <span data-en="Videos" data-hi="à¤µà¥€à¤¡à¤¿à¤¯à¥‹">Videos</span></button>
</nav>
<div class="lang-toggle">
  <button class="active" data-lang="en" onclick="setLang('en', this)">EN</button>
  <button data-lang="hi" onclick="setLang('hi', this)">à¤¹à¤¿à¤‚à¤¦à¥€</button>
</div>
</div>

<main>
  <div class="search">
    <input id="search" placeholder="Search headlines..." oninput="filterContent()" />
  </div>

  <div class="period-select">
    <select id="period" onchange="updatePeriod()">
      <option value="day" selected>Last 24 hours</option>
      <option value="week">Last 7 days</option>
    </select>
  </div>
  
  <div id="loading-message" style="display: none;">Loading the latest news...</div>

  <section id="news" class="active"></section>
  <section id="videos"></section>
</main>

<footer>
  Public RSS sources â€¢ No tracking â€¢ Static site
</footer>

<script>
const RSS_PROXY = "https://api.rss2json.com/v1/api.json?rss_url=";
let CURRENT_LANG = "en";
let CURRENT_PERIOD = "day"; // Default: 24 hours

/* ---------- SOURCES ---------- */
const NEWS_SOURCES = [
  { name: "The Wire", url: "https://thewire.in/rss" },
  { name: "Scroll", url: "https://scroll.in/feed" },
  { name: "Article 14", url: "https://article-14.com/rss" },
  { name: "Newslaundry", url: "https://www.newslaundry.com/rss" }
];

const VIDEO_SOURCES = [
  { name: "Ravish Kumar", url: "https://www.youtube.com/feeds/videos.xml?channel_id=UC0yXUUIaPVAqZLgRjvtMftw" },
  { name: "Ajit Anjum", url: "https://www.youtube.com/feeds/videos.xml?channel_id=UCkquFW943phrj5RbNqtqj4w" },
  { name: "Punya Prasun Bajpai", url: "https://www.youtube.com/feeds/videos.xml?channel_id=UCXCG3leC3eHChlU2OPWMk_A" }
];

/* ---------- HELPER FUNCTIONS ---------- */
function isHindi(text) {
  return /[\u0900-\u097F]/.test(text);
}

function isRecent(pubDate, period = CURRENT_PERIOD) {
  const now = new Date();
  const published = new Date(pubDate);
  if(period === 'day') return (now - published) <= (24 * 60 * 60 * 1000);
  if(period === 'week') return (now - published) <= (7 * 24 * 60 * 60 * 1000);
  return true;
}

/* ---------- LOAD NEWS ---------- */
async function loadNews() {
  const container = document.getElementById("news");
  const loading = document.getElementById("loading-message");
  
  // Safety check to prevent the 'loading is null' error
  if (!loading) return console.error("Loading element is missing from HTML."); 

  container.innerHTML = "";
  loading.style.display = 'block'; // Show loading message

  let articleCount = 0;

  for (const src of NEWS_SOURCES) {
    try {
      const res = await fetch(RSS_PROXY + encodeURIComponent(src.url));
      const data = await res.json();
      
      if (data && data.items && data.status === 'ok') {
          data.items.forEach(item => {
            if(!isRecent(item.pubDate)) return;

            const hindi = isHindi(item.title);
            if ((CURRENT_LANG === "hi" && !hindi) || (CURRENT_LANG === "en" && hindi)) return;

            const article = document.createElement("article");
            article.innerHTML = `
              <h2><a href="${item.link}" target="_blank" rel="noopener noreferrer">${item.title}</a></h2>
              <div class="meta">${src.name} â€¢ ${new Date(item.pubDate).toDateString()}</div>
              <p>${item.description.replace(/<[^>]+>/g, "").slice(0, 220)}â€¦</p>
            `;
            container.appendChild(article);
            articleCount++;
          });
      } else {
        console.error(`RSS Proxy failed to return items for ${src.name}. Status: ${data.status || 'Unknown'}`);
      }

    } catch(error) {
      console.error(`Network or Parsing error for ${src.name}:`, error);
    }
  }
  
  loading.style.display = 'none'; // Hide loading message

  if (articleCount === 0) {
      container.innerHTML = `<div style="text-align: center; padding: 20px; color: var(--muted);">No news articles found for the selected period/language, or the RSS feeds failed to load.</div>`;
  }
}

/* ---------- LOAD VIDEOS ---------- */
async function loadVideos() {
  const container = document.getElementById("videos");
  const loading = document.getElementById("loading-message");

  if (!loading) return;
  
  container.innerHTML = "";
  loading.style.display = 'block';

  let videoCount = 0;

  for (const ch of VIDEO_SOURCES) {
    try {
      const res = await fetch(RSS_PROXY + encodeURIComponent(ch.url));
      const data = await res.json();

      if (data && data.items && data.status === 'ok') {
          data.items.forEach(v => {
            if(!isRecent(v.pubDate)) return;

            const hindi = isHindi(v.title);
            if ((CURRENT_LANG === "hi" && !hindi) || (CURRENT_LANG === "en" && hindi)) return;

            const article = document.createElement("article");
            article.innerHTML = `
              <h2><a href="${v.link}" target="_blank" rel="noopener noreferrer">â–¶ ${v.title}</a></h2>
              <div class="meta">${ch.name} â€¢ ${new Date(v.pubDate).toDateString()}</div>
            `;
            container.appendChild(article);
            videoCount++;
          });
      } else {
        console.error(`RSS Proxy failed to return items for ${ch.name}. Status: ${data.status || 'Unknown'}`);
      }
    } catch(error) {
       console.error(`Network or Parsing error for ${ch.name}:`, error);
    }
  }
  
  loading.style.display = 'none';

  if (videoCount === 0) {
      container.innerHTML = `<div style="text-align: center; padding: 20px; color: var(--muted);">No videos found for the selected period/language, or the feeds failed to load.</div>`;
  }
}


/* ---------- LANGUAGE TOGGLE ---------- */
function setLang(lang, button) {
  CURRENT_LANG = lang;
  
  document.querySelectorAll(".lang-toggle button").forEach(b => b.classList.remove("active"));
  
  if (button) {
    button.classList.add("active");
  } else {
    const defaultButton = document.querySelector(`.lang-toggle button[data-lang="${lang}"]`);
    if (defaultButton) {
        defaultButton.classList.add("active");
    }
  }

  document.querySelectorAll("[data-en]").forEach(el => {
    el.textContent = el.dataset[lang];
  });

  document.getElementById("search").placeholder =
    lang === "hi" ? "à¤–à¥‹à¤œà¥‡à¤‚..." : "Search headlines...";

  const activeTab = document.querySelector('section.active').id;
  if (activeTab === 'news') {
    loadNews();
  } else {
    loadVideos();
  }
}

/* ---------- PERIOD TOGGLE ---------- */
function updatePeriod() {
  CURRENT_PERIOD = document.getElementById('period').value;
  const activeTab = document.querySelector('section.active').id;
  if (activeTab === 'news') {
    loadNews();
  } else {
    loadVideos();
  }
}

/* ---------- TAB SWITCH ---------- */
function switchTab(tab, button) {
  document.querySelectorAll("section").forEach(s => s.classList.remove("active"));
  document.getElementById(tab).classList.add("active");

  document.querySelectorAll("nav button").forEach(b => b.classList.remove("active"));
  
  if (button) {
    button.classList.add("active");
  } else {
    const defaultButton = document.querySelector(`nav button[data-tab="${tab}"]`);
    if (defaultButton) {
        defaultButton.classList.add("active");
    }
  }

  if (tab === 'news') {
    loadNews();
  } else {
    loadVideos();
  }
}

/* ---------- SEARCH FILTER ---------- */
function filterContent() {
  const q = document.getElementById("search").value.toLowerCase();
  document.querySelectorAll("article").forEach(a => {
    a.style.display = a.innerText.toLowerCase().includes(q) ? "block" : "none";
  });
}

/* ---------- INITIAL LOAD - Everything wrapped in DOMContentLoaded ---------- */
document.addEventListener('DOMContentLoaded', (event) => {
    // This sequence calls loadNews() twice, which is safe but might be slightly slower.
    // It ensures all buttons and content are loaded correctly.
    setLang(CURRENT_LANG); 
    switchTab('news');
});
</script>

</body>
</html>
