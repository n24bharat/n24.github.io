<!DOCTYPE html>
<html lang="hi">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>N24.in – Independent Hindi News Monitor</title>
<meta name="description" content="Independent Hindi news aggregation from neutral and critical Indian media. Last 24 hours by default.">

<style>
body {
  margin: 0;
  font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial;
  background: #f3f4f6;
  color: #111827;
}
header {
  background: #fff;
  border-bottom: 3px solid #b91c1c;
  padding: 12px 16px;
  display: flex;
  justify-content: space-between;
  align-items: center;
  position: sticky;
  top: 0;
  z-index: 10;
}
.logo {
  font-weight: 800;
  color: #b91c1c;
  font-size: 1.1rem;
}
.controls {
  display: flex;
  gap: 8px;
  align-items: center;
}
select, input {
  padding: 6px 8px;
  border-radius: 6px;
  border: 1px solid #d1d5db;
}
main {
  max-width: 1000px;
  margin: auto;
  padding: 16px;
}
.grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
  gap: 16px;
}
.card {
  background: #fff;
  border-radius: 10px;
  overflow: hidden;
  border: 1px solid #e5e7eb;
  display: flex;
  flex-direction: column;
}
.thumb img {
  width: 100%;
  height: 160px;
  object-fit: cover;
}
.content {
  padding: 12px;
}
.source {
  font-size: 0.75rem;
  font-weight: 700;
  color: #6b7280;
}
.title {
  font-size: 1rem;
  font-weight: 700;
  margin: 6px 0;
}
.desc {
  font-size: 0.9rem;
  color: #374151;
}
.meta {
  font-size: 0.75rem;
  color: #6b7280;
  padding: 8px 12px;
  border-top: 1px solid #f1f5f9;
  display: flex;
  justify-content: space-between;
}
.loader {
  text-align: center;
  color: #6b7280;
  padding: 20px;
}
</style>
</head>

<body>

<header>
  <div class="logo">N24.in</div>
  <div class="controls">
    <select id="timeFilter">
      <option value="24h">Last 24 hours</option>
      <option value="7d">Last 7 days</option>
      <option value="all">All</option>
    </select>
    <input id="search" placeholder="खोजें…" />
  </div>
</header>

<main>
  <div id="loader" class="loader">Loading independent journalism…</div>
  <div id="feed" class="grid"></div>
</main>

<script>
/* ---------------- CONFIG ---------------- */

const PROXY = "https://corsproxy.io/?url=";

const SOURCES = [
  {
    name: "BBC Hindi",
    direct: "https://feeds.bbci.co.uk/hindi/rss.xml",
    google: "site:bbc.com/hindi"
  },
  {
    name: "DW Hindi",
    direct: "https://rss.dw.com/xml/rss-hi-all",
    google: "site:dw.com/hi"
  },
  {
    name: "The Wire Hindi",
    direct: null,
    google: "site:thewire.in हिंदी"
  },
  {
    name: "Satya Hindi",
    direct: "https://www.satyahindi.com/rss",
    google: "site:satyahindi.com"
  }
];

/* ---------------- HELPERS ---------------- */

function googleRss(q) {
  return `https://news.google.com/rss/search?q=${encodeURIComponent(q)}&hl=hi&gl=IN&ceid=IN:hi`;
}

async function fetchText(url) {
  const r = await fetch(PROXY + encodeURIComponent(url));
  if (!r.ok) throw new Error("Network");
  const t = await r.text();
  if (!t || t.length < 100) throw new Error("Empty");
  return t;
}

function parseItems(xmlText, source) {
  const xml = new DOMParser().parseFromString(xmlText, "text/xml");
  if (xml.querySelector("parsererror")) throw new Error("Parse");
  return [...xml.querySelectorAll("item")].map(it => {
    const linkRaw = it.querySelector("link")?.textContent || "";
    const match = linkRaw.match(/url=([^&]+)/);
    const link = match ? decodeURIComponent(match[1]) : linkRaw;
    return {
      source,
      title: it.querySelector("title")?.textContent || "",
      link,
      date: new Date(it.querySelector("pubDate")?.textContent || Date.now()),
      desc: (it.querySelector("description")?.textContent || "").replace(/<[^>]+>/g,""),
      thumb: it.querySelector("media\\:thumbnail")?.getAttribute("url") || ""
    };
  });
}

async function loadSource(src) {
  try {
    if (src.direct) {
      const xml = await fetchText(src.direct);
      return parseItems(xml, src.name);
    }
  } catch {
    console.warn("Direct RSS failed:", src.name);
  }

  try {
    const xml = await fetchText(googleRss(src.google));
    return parseItems(xml, src.name);
  } catch {
    console.warn("Google RSS failed:", src.name);
  }

  return [];
}

/* ---------------- LOAD ---------------- */

let ALL = [];

async function loadAll() {
  const results = await Promise.allSettled(SOURCES.map(loadSource));
  results.forEach(r => {
    if (r.status === "fulfilled") ALL.push(...r.value);
  });
  render();
}

function render() {
  const feed = document.getElementById("feed");
  const q = search.value.toLowerCase();
  const filter = timeFilter.value;
  const cutoff =
    filter === "24h" ? Date.now() - 86400000 :
    filter === "7d" ? Date.now() - 7*86400000 : 0;

  feed.innerHTML = "";

  ALL
    .filter(i => i.date.getTime() >= cutoff)
    .filter(i => i.title.toLowerCase().includes(q))
    .sort((a,b) => b.date - a.date)
    .forEach(i => {
      const el = document.createElement("article");
      el.className = "card";
      el.innerHTML = `
        ${i.thumb ? `<div class="thumb"><img loading="lazy" src="${i.thumb}"></div>` : ""}
        <div class="content">
          <div class="source">${i.source}</div>
          <div class="title"><a href="${i.link}" target="_blank">${i.title}</a></div>
          <div class="desc">${i.desc.slice(0,160)}…</div>
        </div>
        <div class="meta">
          <span>${i.date.toLocaleDateString("hi-IN")}</span>
          <span><a href="${i.link}" target="_blank">Open ↗</a></span>
        </div>
      `;
      feed.appendChild(el);
    });

  document.getElementById("loader").style.display = "none";
}

search.oninput = render;
timeFilter.onchange = render;

loadAll();
</script>

</body>
</html>
